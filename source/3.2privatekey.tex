\input{source/header/main.tex}

\title{Private-Key Encryption and Pseudorandomness (Part II)}

\begin{document}
\maketitle
\begin{frame}
\frametitle{Outline}
\tableofcontents
\end{frame}
\section{Stream Ciphers And Chosen-Plaintext Attacks}
\begin{frame}\frametitle{Stream Ciphers}
\begin{columns}[t]
\begin{column}{4cm}
\begin{figure}
\begin{center}
\input{tikz/encryptionwithpg}
\end{center}
\end{figure}
\end{column}
\begin{column}{7cm}
\begin{itemize}
\item \textbf{Idea}: Generalization of one-time pad
\item \textbf{Stream cipher}: Enc. by XORing with pseudorandom stream (keystream)
\item \textbf{Multiple messages}: Be concatenated into a single one and encrypted
\item \textbf{Keystream}: Generated by a variable-length PRG
\item \textbf{Strength}: Faster than block cipher
\item \textbf{Weakness}: Difficult to be secure
\end{itemize}
\end{column}
\end{columns}
\end{frame}
\begin{frame}\frametitle{Secure Multiple Encryptions Using a Stream Cipher}
\begin{figure}
\begin{center}
\input{tikz/synchronizedmode}
\end{center}
\end{figure}
\textbf{Initial vector} $IV$ is chosen \emph{u.a.r} and public\\
\alert{Q: which mode is better in your opinion?}
\end{frame}
\begin{frame}\frametitle{Questionable Security}
\begin{itemize}
\item \textbf{State of the art}: No standardized and popular one. Security is questionable, e.g., RC4 in WEP protocol in 802.11, Linear Feedback Shift Registers (LFSRs) used in A5/1 for GSM.
\end{itemize}
\begin{figure}
\begin{center}
\includegraphics[width=50mm]{pic/A5-1_GSM_cipher} 
\end{center}
\end{figure}
\begin{alertblock}{WARNING}
Don't use any stream cipher. If necessary, construct one from a block cipher.
\end{alertblock}
\begin{itemize}
\item eStream project worked on secure stream ciphers. Salsa20/12 is a promising candidate.
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Related Keys: Real World Cases}
Keys (the $IV$-key pair) for multiple enc. must be independent
\begin{exampleblock}{Attacks on 802.11b WEP}
Unsynchronized mode: $\mathsf{Enc}(m_i) := \left< IV_i, G(IV_i\|k) \oplus m_i\right>$\\
\begin{itemize}
\item Length of $IV$ is 24 bits, repeat $IV$ after $2^{24} \approx$ 16M frames
\item On some WiFi cards, $IV$ resets to $0$ after power cycle
\item $IV_i = IV_{i-1} + 1$. For RC4, recover $k$ after 40,000 frames
\end{itemize}
\end{exampleblock}
\end{frame}
\begin{frame}\frametitle{Security for Multiple Encryptions}
The multiple-message eavesdropping experiment $\mathsf{PrivK}^{\mathsf{mult}}_{\mathcal{A},\Pi}(n)$:
\begin{enumerate}
	\item $\mathcal{A}$ is given input $1^n$, outputs $\vec{M}_0=(m_0^1,\dots,m_0^t)$, $\vec{M}_1=(m_1^1,\dots,m_1^t)$ with $\forall i, |m_0^i| = |m_1^i|$.
	\item $k \gets \mathsf{Gen}(1^n)$, a random bit $b \gets \{0,1\}$ is chosen. Then $c^i \gets \mathsf{Enc}_k(m_b^i)$ and $\vec{C}=(c^1,\dots,c^t)$ is given to $\mathcal{A}$.
	\item $\mathcal{A}$ outputs $b'$. If $b' = b$, $\mathsf{PrivK}^{\mathsf{mult}}_{\mathcal{A},\Pi}=1$, otherwise 0.
\end{enumerate}
\begin{figure}
\begin{center}
\input{tikz/multiple-enc-exp.tex}
\end{center}
\end{figure}
\end{frame}
\begin{frame}\frametitle{Definition of Multi-Encryption Security}
\begin{definition}\label{def:sme}
$\Pi$ has \textbf{indistinguishable multiple encryptions in the presence of an eavesdropper} if $\forall$ \textsc{ppt} $\mathcal{A}$, $\exists$ $\mathsf{negl}$ such that
\[ \Pr\left[\mathsf{PrivK}^{\mathsf{mult}}_{\mathcal{A},\Pi}(n)=1\right] \le \frac{1}{2} + \mathsf{negl}(n).
\]
\end{definition}
\begin{exampleblock}{Question:}
Does any cipher we have learned so far have indistinguishable multiple encryptions in the presence of an eavesdropper?
\end{exampleblock}
\end{frame}
\begin{frame}\frametitle{Attack On Deterministic Multiple Encryptions}
\begin{exampleblock}{Generally, if $\Pi$'s encryption function is \textbf{deterministic}, i.e., a plaintext will be always encrypted into the same ciphertext with the same key, is $\Pi$ multiple-encryption-secure?}
For the deterministic encryption, the adversary may generate $m_0^1 = m_0^2$ and $m_1^1 \neq m_1^2$, and then outputs $b'=0$ if $c^1 = c^2$, otherwise $b'=1$.
\end{exampleblock}
\end{frame}
\begin{frame}\frametitle{Chosen-Plaintext Attacks (CPA)}
\textbf{CPA}: the adversary has the ability to obtain the encryption of plaintexts of its choice
\begin{exampleblock}{A story in WWII}
\begin{itemize}
\item Navy cryptanalysts believe the ciphertext ``AF'' means ``Midway island'' in Japanese messages
\item But the general did not believe that Midway island would be attacked
\item Navy cryptanalysts sent a plaintext that the freshwater supplies at Midway island were low
\item Japanese intercepted the plaintext and sent a ciphertext that ``AF'' was low in water
\item The US forces dispatched three aircraft carriers and won
\end{itemize}
\end{exampleblock}
\end{frame}
\begin{frame}\frametitle{CPA Indistinguishability Experiment}
The CPA indistinguishability experiment $\mathsf{PrivK}^{\mathsf{cpa}}_{\mathcal{A},\Pi}(n)$:
\begin{enumerate}
	\item $k \gets \mathsf{Gen}(1^n)$
	\item $\mathcal{A}$ is given input $1^n$ and \textbf{oracle access} $\mathcal{A}^{\mathsf{Enc}_k(\cdot)}$ to $\mathsf{Enc}_k(\cdot)$, outputs $m_0, m_1$ of the same length
	\item $b \gets \{0,1\}$. Then $c \gets \mathsf{Enc}_k(m_b)$ is given to $\mathcal{A}$
	\item $\mathcal{A}$ \textbf{continues to have oracle access} to $\mathsf{Enc}_k(\cdot)$, outputs $b'$
	\item If $b' = b$, $\mathcal{A}$ succeeded $\mathsf{PrivK}^{\mathsf{cpa}}_{\mathcal{A},\Pi}=1$, otherwise 0
\end{enumerate}
\begin{figure}
\begin{center}
\input{tikz/pri-cpa-exp.tex}
\end{center}
\end{figure}
\end{frame}
\begin{frame}\frametitle{Definition of CPA Security}
\begin{definition}\label{def:cap-ind}
$\Pi$ has \textbf{indistinguishable encryptions under a CPA (CPA-secure)} if $\forall$ \textsc{ppt} $\mathcal{A}$, $\exists$ $\mathsf{negl}$ such that
\[ \Pr\left[\mathsf{PrivK}^{\mathsf{cpa}}_{\mathcal{A},\Pi}(n)=1\right] \le \frac{1}{2} + \mathsf{negl}(n).
\]
\end{definition}
\begin{itemize}
\item \alert{Q: Is any cipher we have learned so far CPA-secure? Why?}
\end{itemize}
\begin{proposition}
Any private-key encryption scheme that is CPA-secure also is \textbf{multiple-encryption-secure}.
\end{proposition}
\begin{itemize}
\item \alert{Q: Does \textbf{multiple-encryption-security} mean CPA-security?} (homework)
%\item \textbf{Fixed-length} CPA-secure encryption scheme can be used to construct a \textbf{arbitrary-length} CPA-secure one quite easily.
\end{itemize}
\end{frame}
\section{CPA-Security From Pseudorandom Functions}
\begin{frame}\frametitle{Concepts on Pseudorandom Functions}
\begin{figure}
\begin{center}
\input{tikz/keyed-func.tex}
\end{center}
\end{figure}
\begin{itemize}
\item \textbf{Keyed function} $F : \{0,1\}^* \times \{0,1\}^* \to \{0,1\}^*$ \\
$F_k : \{0,1\}^* \to \{0,1\}^*$, $F_k(x) \overset{\text{def}}{=} F(k,x)$
\item \textbf{Look-up table $f$}: $\{0,1\}^n \to \{0,1\}^n$ with size \alert{ = ? bits} %$n\cdot2^n$.
\item \textbf{Function family $\mathsf{Func}_n$}: all functions $\{0,1\}^n \to \{0,1\}^n$. $|\mathsf{Func}_n| = 2^{n\cdot2^n}$
\item \textbf{Length Preserving}: $\ell_{key}(n) = \ell_{in}(n) = \ell_{out}(n)$
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Definition of Pseudorandom Function}
\textbf{Intuition}: A PRF $F$ generates a function $F_k$ that is indistinguishable from truly random selected function $f$ (look-up table) in $\mathsf{Func}_n$.\\ However, the function has \textbf{exponential length}. Give $D$ the deterministic \textbf{oracle access $D^{\mathcal{O}}$} to the functions $\mathcal{O}$.
\begin{definition}
An efficient length-preserving, keyed function $F$ is a \textbf{pseudorandom function (PRF)} if
$\forall\;$ \textsc{ppt} distinguishers $D$,
\[ \left|\Pr[D^{F_k(\cdot)}(1^n)=1] - \Pr[D^{f(\cdot)}(1^n)=1]\right| \le \mathsf{negl}(n),
\]
where $f$ is chosen \emph{u.a.r} from $\mathsf{Func}_n$.
\end{definition}
%\textbf{PRG vs. PRF}:
%\begin{itemize}
%\item Pseudorandomness over a set of strings vs. a set of functions.
%\item A PRG --- an instance of keyed PRF.
%\end{itemize}
%\textbf{Existence}: if PRG exists. In practice, block ciphers may be PRF.
\end{frame}
\begin{frame}\frametitle{Questions}
\begin{exampleblock}{Q: Is the fixed-length OTP a PRF?}\end{exampleblock}
\begin{exampleblock}{Q: Without knowing the key and the oracle access, could anyone learn something about the output from the input with a non-negligible probability?} 
\end{exampleblock}
\begin{exampleblock}{Let $F: \{0,1\}^{n} \times \{0,1\}^{n} \to \{0,1\}^{n}$ be a PRF. Is $G$ a PRF?}
\begin{enumerate}
\item $G((k_{1},k_{2}), x) = F(k_{1},x) \| F(k_{2},x)$
\item $G(k,x) = F(k, x\oplus 1^{n})$
\item $ G(k,x) = \left\{ 
  \begin{array}{l l}
    F(k,x) & \quad \text{when}\ x \neq 0^{n}\\
    0^{n} & \quad \text{otherwise}\\
  \end{array} \right. $
\item $ G(k,x) = \left\{ 
  \begin{array}{l l}
    F(k,x) & \quad \text{when}\ x \neq 0^{n}\\
    k & \quad \text{otherwise}\\
  \end{array} \right. $
\item $G(k,x) = F(k,x)\bigoplus F(k, x\oplus 1^{n})$
\end{enumerate}
\end{exampleblock}
\end{frame}
\begin{frame}\frametitle{CPA-Security from Pseudorandom Function}
\begin{columns}[t]
\begin{column}{4cm}
\begin{figure}
\begin{center}
\input{tikz/encryptionwithpf}
\end{center}
\end{figure}
\end{column}
\begin{column}{6cm}
\begin{construction}\label{con:cpa}
\begin{itemize}
\item Fresh random string $r$.
\item $F_k(r)$: $\abs{k} = \abs{m} = \abs{r} = n$.
\item $\mathsf{Gen}$: $k \in \{0,1\}^n$.
\item $\mathsf{Enc}$: $s := F_k(r)\oplus m$, $c := \left<r, s\right>$.
\item $\mathsf{Dec}$: $m := F_k(r)\oplus s$.
\end{itemize}
\end{construction}
\begin{theorem}\label{thm:prf}
If $F$ is a PRF, this fixed-length encryption scheme $\Pi$ is CPA-secure.
\end{theorem}
\end{column}
\end{columns}
\end{frame}
\begin{frame}\frametitle{Proof of CPA-Security from PRF}
\textbf{Idea}: First, analyze the security in an idealized world where $f$ is used in $\tilde{\Pi}$; next, claim that if $\Pi$ is insecure when $F_k$ was used then this would imply $F_k$ is not PRF by reduction.
\begin{proof}
Reduce $D$ to $\mathcal{A}$:
\begin{figure}
\begin{center}
\input{tikz/pgfD}
\end{center}
\end{figure}
\end{proof}
\end{frame}
\begin{frame}\frametitle{Proof of CPA-Security from PRF (Cont.)}
\begin{proof}
Analyze $\Pr[\mathsf{Break}]$, $\mathsf{Break}$ means $\mathsf{PrivK}_{\mathcal{A},\tilde{\Pi}}^{\mathsf{cpa}}(n) = 1$:  \\
$\mathcal{A}$ makes $q(n)$ queries and collects $\{ \left< r_i, f(r_i) \right> \}$, as $c_i = \left< r_i, s_i \right>$, and $f(r_i) = s_i \oplus m_i$, for $i=1,\dots,q(n)$.\\
The challenge $c=\left<r_c, f(r_c)\oplus m_b\right>$. \\
\begin{itemize}
\item $\mathsf{Repeat}$: $r_c \in \{ r_i \}$ with probability $\frac{q(n)}{2^n}$. $\mathcal{A}$ can know $m_b$.
\item $\overline{\mathsf{Repeat}}$: As OTP, $\Pr[\mathsf{Break}]=\frac{1}{2}$ 
\end{itemize}
\[
\begin{split}
	\Pr[\mathsf{Break}] & =\Pr[\mathsf{Break} \land \mathsf{Repeat}] + \Pr[\mathsf{Break} \land \overline{\mathsf{Repeat}}] \\
	&\le \Pr[\mathsf{Repeat}] + \Pr[\mathsf{Break} | \overline{\mathsf{Repeat}}] \\
	&\le \frac{q(n)}{2^n} + \frac{1}{2}.
\end{split}
\]

{\footnotesize 
$ \Pr[D^{F_k(\cdot)}(1^n)=1] = \Pr[\mathsf{PrivK}_{\mathcal{A},\Pi}^{\mathsf{cpa}}(n) = 1] = \frac{1}{2} + \varepsilon(n). $
$ \Pr[D^{f(\cdot)}(1^n)=1] = \Pr[\mathsf{PrivK}_{\mathcal{A},\tilde{\Pi}}^{\mathsf{cpa}}(n) = 1] = \Pr[\mathsf{Break}] \le \frac{1}{2} + \frac{q(n)}{2^n}. $
$\Pr[D^{F_k(\cdot)}(1^n)=1] - \Pr[D^{f(\cdot)}(1^n)=1] \ge \varepsilon(n) - \frac{q(n)}{2^n}.$
$\varepsilon(n)$ is negligible.
}
\end{proof}
\end{frame}
\begin{frame}\frametitle{Questions on CPA-security}
\begin{exampleblock}{Q: $G$ is a PRG. Is this scheme CPA-secure?}
$\mathsf{Enc}_k(m) = r, G(k\|r) \oplus m $, where $r$ is a fresh random string.
\end{exampleblock}
\begin{exampleblock}{CPA-Security from PRF for Arbitrary-Length Messages}
\begin{itemize}
\item For arbitrary-length messages, $m = m_1, \dots , m_{\ell}$
\[ c := \left< r_1, F_k(r_1) \oplus m_1, r_2, F_k(r_2) \oplus m_2, \dots, r_\ell, F_k(r_\ell) \oplus m_\ell\right>
\]
\begin{corollary}
If $F$ is a PRF, then $\Pi$ is CPA-secure for arbitrary-length messages.
\end{corollary}
\item What is the shortcoming of this scheme? 
\end{itemize}
\end{exampleblock}
\end{frame}
\section{Modes of Operation}
\begin{frame}\frametitle{Pseudorandom Permutations}
\begin{itemize}
\item \textbf{Bijection}: $F$ is one-to-one and onto
\item \textbf{Permutation}: A bijective function from a set to itself
\item \textbf{Keyed permutation}: $\forall k, F_k(\cdot)$ is permutation
\item $F$ is a bijection $\iff F^{-1}$ is a bijection
\end{itemize}
\begin{definition}
An efficient, keyed permutation $F$ is a \textbf{strong pseudorandom permutation (PRP)} if
$\forall\;$ \textsc{ppt} distinguishers $D$,
\[ \left|\Pr[D^{F_k(\cdot),F_k^{-1}(\cdot)}(1^n)=1] - \Pr[D^{f(\cdot),f^{-1}(\cdot)}(1^n)=1]\right| \le \mathsf{negl}(n),
\]
where $f$ is chosen \emph{u.a.r} from the set of permutations on $n$-bit strings.
\end{definition}
\begin{alertblock}{If $F$ is a PRP then is it a PRF?}
\end{alertblock}
\end{frame}
\begin{frame}\frametitle{Questions}
\begin{exampleblock}{Let $X = \{ 0,1\}$ (1 bit), answer the following questions.}
\begin{enumerate}
\item What are the functions in the permutation over $X$?
\item $K = \{0, 1\}$, what is the simplest permutation $F(k, x)$ over $X$? 
\item Is your $F$ a secure PRP?
\item Is your $F$ a secure PRF?
\item What if $X = \{ 0,1\}^{128}$ and $K = \{0, 1\}^{128}$?
\item Could you give a (or another) PRP over $X = \{ 0,1\}^{128}$?
\end{enumerate}
\end{exampleblock}
\begin{proposition}{Switching Lemma:}
If $F$ is a PRP and additionally $\ell_{in} (n) \ge n$, then $F$ is also a PRF.
\end{proposition}
A random lookup table and a random permutation are indistinguishable. So PRP is also PRF.
\end{frame}
\begin{frame}\frametitle{PRF, PRP, PRG, and Modes of Operation}
\textbf{Modes of Operation:}
\begin{itemize} 
\item A way of encrypting arbitrary-length messages using a PRP or PRF
\item A way of constructing a PRG from a PRP or PRF
\end{itemize}
We will learn how to construct a PRF/PRP from a PRG later.
\end{frame}
\begin{frame}\frametitle{Electronic Code Book (ECB) Mode}
\begin{figure}
\begin{center}
\input{tikz/ECB}
\end{center}
\end{figure}
\begin{itemize}
\item \alert{Q: is it indistinguishable in the presence of an eavesdropper?}
\item \alert{Q: can $F$ be any PRF?}
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Attack on ECB mode}
\begin{figure}
\begin{center}
\includegraphics[width=100mm]{pic/ecb} 
\end{center}
\end{figure}
\end{frame}
\begin{frame}\frametitle{Cipher Block Chaining (CBC) Mode}
\begin{figure}
\begin{center}
\input{tikz/CBC}
\end{center}
\end{figure}
\begin{itemize}
\item $IV$: initial vector, a fresh random string.
\item \alert{Q: is it CPA-secure? what if $IV$ is always $0$?}
\item \alert{Q: is the encryption parallelizable, i.e., outputting $c_{2}$ before getting $c_{1}$?}
\item \alert{Q: can $F$ be any PRF?}
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Output Feedback (OFB) Mode}
\begin{figure}
\begin{center}
\input{tikz/OFB}
\end{center}
\end{figure}
\begin{itemize}
\item \alert{Q: is it CPA-secure?}
\item \alert{Q: is the encryption parallelizable?}
\item \alert{Q: can $F$ be any PRF?}
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Counter (CTR) Mode}
\begin{figure}
\begin{center}
\input{tikz/CTR}
\end{center}
\end{figure}
\begin{itemize}
\item $ctr$ is an $IV$
\item \alert{Q: is it CPA-secure?}
\item \alert{Q: is the encryption parallelizable?}
\item \alert{Q: can $F$ be any PRF?}\end{itemize}
\end{frame}
\begin{frame}\frametitle{CTR Mode Is CPA-secure}
\begin{theorem}
If $F$ is a PRF, then randomized CTR mode is CPA-secure.
\end{theorem}
\begin{proof}
The message length and the number of query are $q(n)$. \\
\textbf{Overlap}: the sequence for the challenge overlaps the sequences for the queries from the adversary.\\
$\mathsf{ctr}^*$: $\mathsf{ctr}$ in the challenge. $\mathsf{ctr}_i$: $\mathsf{ctr}$ in the queries, $i = 1,\dots,q(n)$.\\
$\mathsf{Overlap}$: $\mathsf{ctr}_i-q(n) < \mathsf{ctr}^* < \mathsf{ctr}_i + q(n)$.\\
\[\Pr[\mathsf{Overlap}] \le \frac{2q(n)-1}{2^n} \cdot q(n)\]
\end{proof}
\end{frame}
\begin{frame}\frametitle{Proof of CPA-secure CTR Mode (Cont.)}
\begin{proof}
See proof of theorem \ref{thm:prf}.
(1) Analyze $\mathsf{Break}$ : $\mathsf{PrivK}_{\mathcal{A},\tilde{\Pi}}^{\mathsf{cpa}}(n)=1$.
\[
\begin{split}
	\Pr[\mathsf{Break}] & =\Pr[\mathsf{Break} \land \mathsf{Overlap}] + \Pr[\mathsf{Break} \land \overline{\mathsf{Overlap}}] \\
	&\le \Pr[\mathsf{Overlap}] + \Pr[\mathsf{Break} | \overline{\mathsf{Overlap}}] \\
	&\le \frac{2q(n)^2}{2^n} + \frac{1}{2}.
\end{split}
\]
(2) Reduce $D$ to $\mathcal{A}$
\[ \Pr[D^{f(\cdot)}(1^n)=1]=\Pr[\mathsf{PrivK}_{\mathcal{A},\tilde{\Pi}}^{\mathsf{cpa}}(n)=1] \le \frac{2q(n)^2}{2^n} + \frac{1}{2}
\]
\[\Pr[D^{F_k(\cdot)}(1^n)=1]=\Pr[\mathsf{PrivK}_{\mathcal{A},\Pi}^{\mathsf{cpa}}(n)=1] \le \frac{1}{2} + \varepsilon(n)
\]
\[ \text{If } F \text{ is PRP}, \varepsilon(n) \text{ is negligible.}
\]
\end{proof}
\end{frame}
\begin{frame}[fragile]\frametitle{$IV$ Should Not Be Predictable}
If $IV$ is predictable, then CBC mode is not CPA-secure.\\
\alert{Q: Why? (homework)}
\begin{exampleblock}{Bug in SSL/TLS 1.0}
$IV$ for record $\#i$ is last CT block of record $\#(i-1)$.
\end{exampleblock}
\begin{exampleblock}{API in OpenSSL}
\verb#void AES_cbc_encrypt (# \\
\verb#    const unsigned char *in,# \\
\verb#    unsigned char       *out,# \\
\verb#    size_t              length,# \\
\verb#    const AES_KEY       *key,# \\
\verb#    unsigned char       *ivec,   #  \alert{\textbf{User supplies $IV$}} \\
\verb#    AES_ENCRYPT or AES_DECRYPT);# \\
\end{exampleblock}
\end{frame}
%\begin{frame}\frametitle{PRP/PRF Switching Lemma (FYI)}
%\begin{lemma}
%$\forall\;$ \textsc{ppt} distinguishers $D$,
%\[ \left|\Pr[D^{f}=1] - \Pr[D^{p}=1]\right| \le \frac{q^{2}}{2^{n+1}},
%\]
%where $f$/$p$ is chosen \emph{u.a.r} from the set of functions/permutations on $n$-bit strings.
%\end{lemma}
%\begin{exampleblock}
%\end{exampleblock}
%\end{frame}
\begin{frame}\frametitle{Non-deterministic Encryption}
Three general methods of non-deterministic encryption for CPA security.\\
$\mathsf{Enc}$: $s := F_k(r)\oplus m$, $c := \left<r, s\right>$.
\begin{itemize}
\item \textbf{Randomized}: $r$ is chosen $u.a.r$, as Construction \ref{con:cpa}
\begin{itemize}
\item more entropy needed, and long ciphertext
\end{itemize}
\item \textbf{Stateful}: $r$ is a counter, like CTR mode
\begin{itemize}
\item synchronization on the counter between two parties
\end{itemize}
\item \textbf{Nonce-based}: $r$ is a nonce (number used only once)
\begin{itemize}
\item make sure that nonces are distinct , and long ciphertext
\end{itemize}
\end{itemize}
\end{frame}
\section{Security Against Chosen-Ciphertext Attacks (CCA)}
\begin{frame}\frametitle{Security Against CCA}
The CCA indistinguishability experiment $\mathsf{PrivK}^{\mathsf{cca}}_{\mathcal{A},\Pi}(n)$:
\begin{enumerate}
	\item $k \gets \mathsf{Gen}(1^n)$.
	\item $\mathcal{A}$ is given input $1^n$ and oracle access $\mathcal{A}^{\mathsf{Enc}_k(\cdot)}$ and $\mathcal{A}^{\mathsf{Dec}_k(\cdot)}$, outputs $m_0, m_1$ of the same length.
	\item $b \gets \{0,1\}$. $c \gets \mathsf{Enc}_k(m_b)$ is given to $\mathcal{A}$.
	\item $\mathcal{A}$ continues to have oracle access \alert{\textbf{except for $c$}}, outputs $b'$.
	\item If $b' = b$, $\mathcal{A}$ succeeded $\mathsf{PrivK}^{\mathsf{cca}}_{\mathcal{A},\Pi}=1$, otherwise 0.
\end{enumerate}
\begin{definition}
$\Pi$ has \textbf{indistinguishable encryptions under a CCA (CCA-secure)} if $\forall$ \textsc{ppt} $\mathcal{A}$, $\exists$ $\mathsf{negl}$ such that
\[ \Pr\left[\mathsf{PrivK}^{\mathsf{cca}}_{\mathcal{A},\Pi}(n)=1\right] \le \frac{1}{2} + \mathsf{negl}(n).
\]
\end{definition}
\end{frame}
\begin{frame}\frametitle{Understanding CCA-security}
\begin{itemize}
\item In real world, the adversary might conduct CCA by influencing what gets decrypted
\begin{itemize}
\item If the communication is not authenticated, then an adversary may send certain ciphertexts on behalf of the honest party
\end{itemize}
\item CCA-security implies ``\textbf{non-malleability}''
\item None of the above scheme is CCA-secure
\end{itemize}
\begin{exampleblock}{CCA against Construction \ref{con:cpa}}
$\mathcal{A}$ gives $m_{0}, m_{1}$ and gets $c = \left<r, F_k(r)\oplus m_{b}\right>$, 
and then queries $c'$ which is the same with $c$ except that a single bit is flipped. 
The $m' = c' \oplus F_k(r)$ should be the same with $m_{b}$ \alert{except \underline{$\qquad$}?}
\end{exampleblock}
\alert{Q: Show that the above modes (CBC, OFB and CTR) are also not CCA-secure. (homework)}
\end{frame}
\begin{frame}\frametitle{Padding-Oracle Attacks: Real-world Case}
Padding-oracle attacks are originally published in 2002. It can be used to automatically obtain the CAPTCHA text, as CAPTCHA server will return an error (as decryption oracle) when deciphering the CT of a CAPTCHA text received from a user.
\begin{figure}
\begin{center}
\input{tikz/padding-oracle}
\end{center}
\end{figure}
\end{frame}
\begin{frame}\frametitle{Padding-Oracle Attacks}
\textbf{PKCS \#5 Padding}:  append $b$ bytes of $b$ to the message in order to make the total length a multiple of the block length (append a dummy block if needed). The decryption server will return a \textbf{Bad Padding Error} for incorrect padding.\\
\textbf{Padding-Oracle Attacks}: 
\begin{itemize}
	\item modify the ciphertext (including $IV$) and send it to the server.
	\item Triggering a \textbf{Bad Padding Error} means the modification is on the padding part. Otherwise, the modification is on the plaintext part.
	\item By carefully manipulating the ciphertext to control the padding part, the attacker can learn the length and the content of the plaintext.
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Padding-Oracle Attacks: Learning the length}
\begin{figure}
\begin{center}
\input{tikz/padding-oracle-null}
\end{center}
\end{figure}
\begin{itemize}
\item In a one-block CBC, by modifying the 1st byte of $IV$, attacker can learn whether $m$ is NULL. If yes, error will occur. 
\item append $\{b\}^b$ as a dummy block if $m$ is NULL
\item change the 1st byte of $IV$ from $x$ to $y$, get decrypted block $(x \oplus y \oplus b) \| \{b\}^{b-1}$, and trigger an error
\item If no error, learn whether $m$ is 1 byte by modifying the 2nd byte of $IV$ and so on
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Padding-Oracle Attacks: Learning the content}
\begin{figure}
\begin{center}
\input{tikz/padding-oracle-lastbyte}
\end{center}
\end{figure}
\begin{itemize}
\item Once learn the length of $m$, learn the last byte of $m$ ($s$) by modifying the one before the last block in the ciphertext
\item $m_{last} = \cdots s \| \{b\}^{b}$, $c_{last-1} = \cdots t \| \{\cdot \}^{b} $
\item modify $c_{last-1}$ to $c_{last-1}' = \cdots u \| (\{\cdot \}^{b} \oplus \{b\}^{b} \oplus \{b+1\}^{b}) $
\item \alert{Q: If no padding error, then $s$ = ?}
% s ^ t = u  ^ (b+1),  s= u ^ (b+1) ^ t
\end{itemize}
\end{frame}
\begin{frame}\frametitle{Summary}
\begin{itemize}
\item Definitions: CPA, CCA (padding-oracle attack)
\item Primitives: PRG, PRF, PRP
\item Constructions: stream cipher, block cipher, EBC, CBC, OFB, CTR
\end{itemize}
\end{frame}
\end{document}
